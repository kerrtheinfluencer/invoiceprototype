<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jamaica Online Seller Tracker</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root {
      --green-dark: #006400;
      --green-med: #228B22;
      --gold: #d4af37;
      --bg: #0a0a0a;
      --card: #111111;
      --border: #333333;
      --text: #e0e0e0;
      --text-light: #aaaaaa;
      --red: #c0392b;
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px 16px;
      line-height: 1.6;
    }

    .container { max-width: 960px; margin: 0 auto; }

    h1 {
      font-size: 2.5rem;
      text-align: center;
      margin-bottom: 12px;
      background: linear-gradient(90deg, var(--green-dark), var(--gold), var(--green-med));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 800;
    }

    h2 {
      font-size: 1.8rem;
      margin: 32px 0 16px;
      color: white;
      border-bottom: 2px solid var(--green-med);
      padding-bottom: 8px;
    }

    label {
      display: block;
      font-size: 1rem;
      font-weight: 600;
      margin: 16px 0 8px;
      color: #ddd;
    }

    input, select, textarea {
      width: 100%;
      padding: 14px 16px;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 10px;
      color: white;
      font-size: 1rem;
      margin-bottom: 12px;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(212,175,55,0.2);
    }

    button {
      background: var(--green-dark);
      color: white;
      border: none;
      padding: 14px 24px;
      border-radius: 10px;
      font-size: 1.05rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin: 8px 0;
    }

    button:hover {
      background: var(--green-med);
      transform: translateY(-1px);
    }

    .add-item-btn {
      background: linear-gradient(to right, var(--green-med), var(--green-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      font-size: 1.1rem;
      padding: 16px;
      margin: 16px 0;
      width: 100%;
    }

    .items-section {
      margin: 20px 0;
    }

    .item-row {
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 12px;
      padding: 16px;
      margin: 12px 0;
      position: relative;
      transition: border-color 0.2s;
    }

    .item-row:hover {
      border-color: var(--gold);
    }

    .remove-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: var(--red);
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 1.1rem;
      line-height: 28px;
      text-align: center;
      cursor: pointer;
      transition: background 0.2s;
    }

    .remove-btn:hover {
      background: #a00;
    }

    .item-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 12px;
      align-items: center;
    }

    @media (max-width: 600px) {
      .item-grid {
        grid-template-columns: 1fr;
      }
    }

    #summary {
      font-size: 1.3rem;
      font-weight: bold;
      text-align: center;
      margin: 24px 0;
      padding: 16px;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 12px;
    }

    .order-item {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .feedback {
      padding: 12px;
      margin: 12px 0;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
    }

    .success { background: #004d00; color: #90ee90; }
    .error   { background: #600; color: #ff9999; }
  </style>
</head>
<body>

<div class="container">
  <h1>Jamaica Online Seller Tracker</h1>
  <p style="text-align:center; color:#aaa; margin-bottom:32px;">Add sales → Save → View → PDF or CSV</p>

  <div class="card">
    <h2>New Order</h2>

    <form id="orderForm">
      <label>Customer Name *</label>
      <input type="text" id="customerName" required oninput="this.value = this.value.replace(/\b\w/g, l => l.toUpperCase())">

      <label>Phone / WhatsApp *</label>
      <div style="position:relative;">
        <span style="position:absolute; left:16px; top:50%; transform:translateY(-50%); color:#888; pointer-events:none; font-weight:bold;">+1-876-</span>
        <input type="tel" id="customerPhone" required placeholder="Enter 7 digits (e.g. 5551234)" maxlength="8" style="padding-left:90px;">
      </div>

      <label>Platform</label>
      <select id="platform">
        <option>Instagram</option>
        <option>WhatsApp</option>
        <option>Facebook</option>
        <option>TikTok</option>
        <option>7Krave</option>
        <option>Other</option>
      </select>

      <label>Notes</label>
      <textarea id="notes" rows="2" placeholder="Delivery info, custom requests..."></textarea>

      <label>Payment Status</label>
      <select id="paymentStatus">
        <option>Pending</option>
        <option>Partial</option>
        <option>Paid - Cash</option>
        <option>Paid - Transfer</option>
        <option>Paid - Card</option>
      </select>

      <h3>Items</h3>
      <div id="items-container" class="items-section"></div>
      <button type="button" onclick="addItemRow()" class="add-item-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Add Item
      </button>

      <label>Delivery Fee (JMD)</label>
      <input type="number" id="deliveryFee" value="0" min="0" step="0.01">

      <div id="summary" style="font-size:1.3rem; font-weight:bold; margin:20px 0; text-align:center;">
        Subtotal: J$0.00   |   Total: J$0.00
      </div>

      <button type="submit">Save Order & Generate Receipt</button>

      <div id="feedback" class="feedback"></div>
    </form>
  </div>

  <div class="card">
    <h2>Saved Orders</h2>
    <p id="totalRevenue" style="font-size:1.2rem; margin-bottom:16px;">Total Revenue: J$0.00 | Orders: 0</p>
    <button onclick="exportCSV()" style="background:#1e90ff;">Export All to CSV</button>
    <div id="orders-list" style="margin-top:24px;"></div>
  </div>
</div>

<script>
  const { jsPDF } = window.jspdf;
  let orders = JSON.parse(localStorage.getItem('jamaicaSalesOrders')) || [];

  function saveOrders() {
    localStorage.setItem('jamaicaSalesOrders', JSON.stringify(orders));
    updateDashboard();
    renderOrders();
  }

  function updateDashboard() {
    let total = orders.reduce((sum, o) => sum + o.total, 0);
    document.getElementById('totalRevenue').textContent = 
      `Total Revenue: J$${total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')} | Orders: ${orders.length}`;
  }

  function renderOrders() {
    const list = document.getElementById('orders-list');
    list.innerHTML = '';
    orders.forEach((order, index) => {
      const div = document.createElement('div');
      div.className = 'order-item';
      div.innerHTML = `
        <strong>Order #${index+1} - ${order.date}</strong><br>
        Customer: ${order.customerName}<br>
        Platform: ${order.platform} | Status: ${order.paymentStatus}<br>
        Total: J$${order.total.toFixed(2)}<br>
        <button onclick="generatePDF(${index})" style="background:var(--green-med); margin-top:12px;">Download PDF</button>
      `;
      list.appendChild(div);
    });
  }

  function addItemRow() {
    const container = document.getElementById('items-container');
    const row = document.createElement('div');
    row.className = 'item-row';
    row.innerHTML = `
      <button type="button" class="remove-btn" onclick="this.parentElement.remove(); updateSummary()">X</button>

      <label>Item name/desc</label>
      <input type="text" placeholder="e.g. 20 inch wig" class="item-name">

      <div class="item-grid">
        <div>
          <label>Qty</label>
          <input type="number" placeholder="1" value="1" min="1" class="item-qty">
        </div>
        <div>
          <label>Price (JMD)</label>
          <input type="number" placeholder="0" value="0" min="0" step="0.01" class="item-price">
        </div>
      </div>
    `;
    container.appendChild(row);
    updateSummary();
  }

  function updateSummary() {
    let subtotal = 0;
    document.querySelectorAll('.item-row').forEach(row => {
      const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
      const price = parseFloat(row.querySelector('.item-price').value) || 0;
      subtotal += qty * price;
    });
    const delivery = parseFloat(document.getElementById('deliveryFee').value) || 0;
    const total = subtotal + delivery;
    document.getElementById('summary').textContent = `Subtotal: J$${subtotal.toFixed(2)} | Total: J$${total.toFixed(2)}`;
  }

  document.getElementById('orderForm').addEventListener('submit', e => {
    e.preventDefault();

    const feedback = document.getElementById('feedback');

    const items = [];
    document.querySelectorAll('.item-row').forEach(row => {
      const name = row.querySelector('.item-name').value.trim();
      const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
      const price = parseFloat(row.querySelector('.item-price').value) || 0;
      if (name && qty > 0) items.push({name, qty, price});
    });

    if (!document.getElementById('customerName').value.trim()) {
      feedback.textContent = "Customer name is required";
      feedback.className = "feedback error";
      return;
    }
    if (items.length === 0) {
      feedback.textContent = "Add at least one item";
      feedback.className = "feedback error";
      return;
    }

    const order = {
      date: new Date().toLocaleString('en-JM'),
      customerName: document.getElementById('customerName').value.trim(),
      customerPhone: document.getElementById('customerPhone').value.trim(),
      platform: document.getElementById('platform').value,
      notes: document.getElementById('notes').value.trim(),
      paymentStatus: document.getElementById('paymentStatus').value,
      deliveryFee: parseFloat(document.getElementById('deliveryFee').value) || 0,
      items,
      subtotal: items.reduce((s, i) => s + i.qty * i.price, 0),
      total: items.reduce((s, i) => s + i.qty * i.price, 0) + (parseFloat(document.getElementById('deliveryFee').value) || 0)
    };

    orders.push(order);
    saveOrders();

    e.target.reset();
    document.getElementById('items-container').innerHTML = '';
    addItemRow();

    feedback.textContent = 'Order saved successfully!';
    feedback.className = 'feedback success';
  });

  function generatePDF(index) {
    const order = orders[index];
    const doc = new jsPDF();
    let y = 20;
    doc.setFontSize(18);
    doc.text("Receipt", 105, y, { align: "center" });
    y += 12;
    doc.setFontSize(12);
    doc.text(`Order #${index+1} - ${order.date}`, 20, y);
    y += 10;
    doc.text(`Customer: ${order.customerName}`, 20, y);
    doc.text(`Phone: ${order.customerPhone}`, 20, y += 7);
    doc.text(`Platform: ${order.platform}`, 20, y += 7);
    if (order.notes) doc.text(`Notes: ${order.notes}`, 20, y += 7);
    y += 12;
    doc.text("Items:", 20, y);
    y += 8;
    order.items.forEach(item => {
      doc.text(`${item.qty} × ${item.name} @ J$${item.price.toFixed(2)} = J$${(item.qty * item.price).toFixed(2)}`, 25, y);
      y += 8;
    });
    y += 8;
    doc.text(`Subtotal: J$${order.subtotal.toFixed(2)}`, 20, y);
    doc.text(`Delivery: J$${order.deliveryFee.toFixed(2)}`, 20, y += 8);
    doc.setFontSize(14);
    doc.text(`TOTAL: J$${order.total.toFixed(2)}`, 20, y += 10);
    doc.save(`receipt_${index+1}.pdf`);
  }

  function exportCSV() {
    if (orders.length === 0) return alert('No orders to export!');
    let csv = 'Order#,Date,Customer,Phone,Platform,Status,Items,Subtotal,Delivery,Total\n';
    orders.forEach((o, i) => {
      const itemsStr = o.items.map(it => `${it.qty}x ${it.name} @${it.price}`).join('; ');
      csv += `${i+1},${o.date},"${o.customerName.replace(/"/g,'""')}","${o.customerPhone}",${o.platform},${o.paymentStatus},"${itemsStr}",${o.subtotal},${o.deliveryFee},${o.total}\n`;
    });
    const blob = new Blob([csv], {type: 'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'sales_export.csv';
    a.click();
    URL.revokeObjectURL(url);
  }

  // Init
  addItemRow();
  updateDashboard();
  renderOrders();
  document.querySelectorAll('input[type=number]').forEach(el => el.addEventListener('input', updateSummary));
</script>
</body>
</html>
